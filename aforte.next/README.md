# Шаблон для быстрого развёртывания приложения React (SPA/NextJS)
## **Мэнеджер пакетов Yarn:**
Для инициализации проекта запустить скрипт 
```bash
yarn initialize spa
# или
yarn initialize next
```

Для запуска в режиме разработки
```bash
yarn start # для SPA
yarn dev # для NextJs
```

Для сборки
```bash
yarn build
```

Для запуска Next Server в прод
```bash
yarn prod
```

---

 **`Модуль` - Независимая часть бизнес-логики**

 **`Компонент` - часть интерфейса**

### 1. **"`Модульная`" структура проекта/папок**

  - `public` - содержит статичные файлы доступные по прямому URL (JSON, картинки, иконки и т.д.)

  - `src` - все файлы проекта
  
  - `src/api` - файлы репозиториев, содержат методы для вызова API

  - `src/pages` - файлы точек входа на страницу (те компоненты которые используются для роутинга)

  - `src/styles` - файлы css/scss

  - `src/modules/*` - файлы, компоненты, хуки, константы, интерфейсы, утилиты..., которые относятся к этому модулю

  - `src/common` - общие файлы, компоненты, хуки, константы, интерфейсы, утилиты..., то что переиспльзуется в разных модулях или не относится к какому либо модулю

  - `src/common` и `src/modules/*` - дублируют структуру (плюс содержат индивидуальные файлы и папки):
    - `components` - компоненты
    - `interfaces` - типы и интерфейсы
    - `constants` - константы
    - `hooks` - хуки
    - `utils` - функции

Компоненты, хуки, константы выносятся в общюю папку если они используются более чем в одном модуле.

Если компонент состоит более чем из одного файла, все файлы компонента кладём в папку с название компонента

### **2. State**
Для работы с глобальным состоянием используем [ReduxToolkit](https://redux-toolkit.js.org/)

### **3. API**
Для работы с API используем 
[RTK Query](https://redux-toolkit.js.org/rtk-query/overview) и 
[Axios](https://axios-http.com/docs/intro)

### **4. Обработка ошибок**
В `BaseQuery` ловим все ошибки. Функция `src/api/baseApi/handleError` обрабатывает все ошибки. 

После обработки ошибок генерируем событие, в обект сабытия кладём обект ошибки. Любой желающий может прослушать это событие и отреагировать на него.

### **5. Локализация ошибок**

  - `public/locales/ru.json` - пример файла локализации типа ошибки с бэка

  В `src/common/i18n.ts` методом **fetch** загрузжется фаил локализации ошибок с бэкэнда

  - `public/locales/en/*` - файлы с английской локализацией
  - `public/locales/ru/*` - файлы с русской локализацией

  Локализация настраивается в `src/common/i18n.ts`

  [Документация по i18n](https://react.i18next.com/)

### **6. Работа с модалками**

  - `src/interfaces/modal.ts` - При создании новой модалки поместить её имя в enum **ModalNames**. Параметры компонента модалки наследовать от **ModalProps**.
  - `src/constants/modals.tsx` - При создании новой модалки добавить её в **modalsMap**.
  - `src/hooks/useModal.tsx` - Используется в AppContexte, его методу (**openModal** и **closeModal**) доступны в любом месте приложения из контекста.

Для открытия модального окна использовать метод openModal из AppContexta, пример:

```JavaScript
openModal(modalName: ModalNames, modalProps: ComponentProps extends ModalProps)
```
Другие параметры для компонента модального окна передаются вторым аргументом в метод **openModal**

### **7. Навигация:**

В **Next** навигация образуется из структуры в папке pages [Next Router](https://nextjs.org/docs/routing/introduction)

В **SPA** навигация по проекту заполняется в файлах:

1) src/common/hooks/useCreateRouter.tsx - возвращает объект createBrowserRouter для создания Route.
2) src/common/constants/paths.ts - список доступных url в проекте (на него нужно ссылаться во всех постраничных переходах в проекте)

`src/common/components/MenuList.tsx` - Пример компонента для генерации меню

#### ***8. Контроль доступа к элементам:***
`src/common/constants/policyOfNavigation.ts` - возвращает объект содержащий список policy для страниц *(для каждой страницы можно описать свою функцию доступа, ***функция проверки должна возвращать boolean***)*

### **9. Стили, CSS** 
Для работы со стилями используем [Astroturf](https://4catalyzer.github.io/astroturf/introduction/)
### **10. Работа с иконками и изображениями**
Иконки хранятся в `public/icons`. для иконок используем `svg sprite`

Изображения хранятся в `public/images`

Структура по модульная

для отображения изображений в Next использовать `Next/image`

для SPA - в случае необходимости изменения размеров изображения использовать сервис на базе модуля [Image.Resizer](http://git.dextechnology.com/Frontend/modules/image.resizer)

Подключение модуля в проект:
```bash
yarn submodule 
```
параметры из файлф `src/common/utils/imageResizer/index.ts` можно вынести в переменные окружения

Использование в компоненте:

```
import { helper } from "common/utils/imageResizer";

<img src={helper.getImageUrl({sourceUrl, width, height})}>
```
### **11. Валидация**

В `src/common/constants` - фаил с регэкспами для валидации

### **13. Адаптивная верстка и тестирование результата**